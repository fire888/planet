!function(){"use strict";function e(){n(function(){r(),t()})}function t(){d=setInterval(i,30)}function i(){for(var e in S)o(S[e])}function n(e){for(var t in S)!function(e){for(var t in S[e].imgs)!function(t){T.push(function(){S[e].imgs[t].data=new Image,S[e].imgs[t].data.src=S[e].imgs[t].src,S[e].imgs[t].data.onload=function(){H++,T[H]()}})}(t)}(t);T.push(function(){e()}),T[0]()}function r(){for(var e in S)S[e].canvas=document.getElementById(e),S[e].ctx=S[e].canvas.getContext("2d"),a(e)}function o(e){e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.ctx.globalCompositeOperation="source-over",e.ctx.drawImage(e.imgs.back.data,0,0,e.canvas.width,e.canvas.height),u(e),e.imgs.wire&&e.ctx.drawImage(e.imgs.wire.data,e.imgs.wire.x,e.imgs.wire.y),e.ctx.globalCompositeOperation="destination-in",e.ctx.drawImage(e.imgs.back.data,0,0,e.canvas.width,e.canvas.height)}function a(e){"dr01"==e&&S[e].sprites.push(s("TopCONUSSuperSpr",30)),"dr02"==e&&(S[e].sprites.push(s("LeftNORM",70)),S[e].sprites.push(s("RightBAD",10))),"dr03"==e&&(S[e].sprites.push(s("LeftCONUS",70)),S[e].sprites.push(s("RightCONUS",70))),"dr04"==e&&(S[e].sprites.push(s("LeftCONUS",50)),S[e].sprites.push(s("LeftCONUSSuperSpr",50)),S[e].sprites.push(s("LeftCONUSgreen",50)),S[e].sprites.push(s("RightCONUS",50)),S[e].sprites.push(s("RightCONUSSuperSpr",50)),S[e].sprites.push(s("RightCONUSgreen",50))),"dr05"==e&&(S[e].sprites.push(s("LeftCONUSSuperSpr",300)),S[e].sprites.push(s("RightCONUSSuperSpr",300)))}function s(e,t){for(var i=[],n=0;n<t;n++){var r={};l(r,e),i.push(r)}return i}function l(e,t){var i=b[t],n=30*Math.random()+30;e.type=t,e.x=Math.random()*(i.start.xMax-i.start.xMin)+i.start.xMin,e.y=Math.random()*(i.start.yMax-i.start.yMin)+i.start.yMin,e.spdX=(i.finish.xMin-e.x)/n,e.spdY=(i.finish.yMin-e.y+Math.random()*(i.finish.yMax-i.finish.yMin)*i.conus)/n,e.color=Object.assign({},i.color)}function u(e){for(var t=0;t<e.sprites.length;t++)for(var i=0;i<e.sprites[t].length;i++)c(e,e.sprites[t][i])}function c(e,t){var i=b[t.type];t.x>i.finish.xMin&&l(t,t.type),t.x+=t.spdX,t.y+=t.spdY,e.ctx.fillStyle=" rgba("+t.color.r+","+t.color.g+","+t.color.b+","+t.color.opasity+")",e.ctx.fillRect(t.x,t.y,10,10)}var d,f={uniforms:{red:{value:0},green:{value:.021},blue:{value:.04},tDiffuse:{value:null},light:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#ifdef GL_ES","precision mediump float;","#endif","uniform float red;","uniform float green;","uniform float blue;","uniform sampler2D tDiffuse;","uniform float light;","varying vec2 vUv;","float point (in vec2 uv, in vec2 center, in float radius) {","float len = length(center - uv);","return float(1. - smoothstep(radius, radius + .6, len));","}","void main() {","vec2 uv = vUv;","vec4 diff = texture2D(tDiffuse, uv);","vec2 tileuv = vec2(uv.x, uv.y*0.8) * 180.;","float radius = .03;","vec2 center = floor( tileuv ) + vec2( 0.5, 0.5 );","float point = point( tileuv, center, radius );","vec4 points = vec4( red + light, green + light, blue + light,  (1.01 - diff.y) * point );","vec4 contur = vec4( red + light, green + light, blue + light,  diff.x );","vec4 continents = vec4( red, green, blue, (1.5 - diff.y) * (1.0 - points.z) * 0.01 );","gl_FragColor = contur + continents + points;","}"].join("\n")},g={uniforms:{viewVector:{value:new THREE.Vector3(-800,-200,8200)},light:{value:.3},glowColor:{value:new THREE.Vector3(0,.24,.47)},border:{value:3.3}},vertexShader:["uniform vec3 viewVector;","uniform float light;","uniform float border;","varying float intensity;","void main() {","vec3 vNormal = normalize( normalMatrix * normal );","vec3 vNormel = normalize( normalMatrix * viewVector );","intensity = pow( abs(light) - dot(vNormal, vNormel), border );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 glowColor;","uniform float light;","varying float intensity;","void main() {","vec3 glow = ( glowColor + light ) * intensity;","gl_FragColor = vec4( glow, 1.0 );","}"].join("\n")},p={uniforms:{color:{value:new THREE.Vector3(1.5,1.5,1.9)},light:{value:1}},vertexShader:["uniform float light;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float light;","uniform vec3 color;","void main() {","gl_FragColor = vec4( color * light, 1.0 );","}"].join("\n")},h=void 0,v=function(){var e=document.getElementById("app-webgl"),t=e.clientWidth||e.offsetWidth;return t>window.innerWidth&&(t=window.innerWidth),t},x=function(e){h=e,window.addEventListener("resize",function(){h(v())},!1)},m=void 0,M=function(e){m=e,document.addEventListener("wheel",y,!1),document.addEventListener("scroll",y,!1),document.addEventListener("touchstart",y,!1)},y=function(){m(),w(),setTimeout(function(){document.getElementById("slogan").className="show"},500)},w=function(){document.removeEventListener("wheel",y,!1),document.removeEventListener("scroll",y,!1),document.removeEventListener("touchstart",y,!1)},E=function(){document.getElementById("webgl").className="show"},R=function(){var e=document.getElementById("preloader");e.className="hide",setTimeout(function(){e.className="hidden"},1e3)},S={dr01:{canvas:null,ctx:null,sprites:[],imgs:{back:{src:"assets/ill_01_back.png",data:null},wire:{src:"assets/ill_01_img.png",data:null,x:30,y:0}}},dr02:{canvas:null,ctx:null,sprites:[],imgs:{back:{src:"assets/ill_02_back.png",data:null},wire:{src:"assets/ill_02_wire.png",data:null,x:120,y:150}}},dr03:{canvas:null,ctx:null,sprites:[],imgs:{back:{src:"assets/ill_03_back.png",data:null},wire:{src:"assets/ill_03_wire.png",data:null,x:80,y:70}}},dr04:{canvas:null,ctx:null,sprites:[],imgs:{back:{src:"assets/ill_04_back.png",data:null},wire:{src:"assets/ill_04_wire.png",data:null,x:80,y:70}}},dr05:{canvas:null,ctx:null,sprites:[],imgs:{back:{src:"assets/ill_05_back.png",data:null},wire:{src:"assets/ill_05_wire.png",data:null,x:0,y:65}}}},b={LeftNORM:{conus:1,start:{xMin:-20,xMax:-10,yMin:80,yMax:300},finish:{xMin:160,xMax:280,yMin:80,yMax:300},color:{r:"255",g:"255",b:"0",opasity:1}},RightBAD:{conus:1,start:{xMin:310,xMax:320,yMin:180,yMax:183},finish:{xMin:500,xMax:510,yMin:110,yMax:230},color:{r:"255",g:"255",b:"255",opasity:.5}},LeftCONUS:{conus:1,start:{xMin:-20,xMax:-10,yMin:80,yMax:300},finish:{xMin:160,xMax:280,yMin:150,yMax:205},color:{r:"255",g:"255",b:"0",opasity:1}},LeftCONUSred:{conus:1,start:{xMin:-20,xMax:-10,yMin:80,yMax:300},finish:{xMin:160,xMax:280,yMin:150,yMax:205},color:{r:"255",g:"0",b:"0",opasity:1}},LeftCONUSgreen:{conus:1,start:{xMin:-20,xMax:-10,yMin:80,yMax:300},finish:{xMin:160,xMax:280,yMin:150,yMax:205},color:{r:"0",g:"255",b:"0",opasity:1}},RightCONUS:{conus:1,start:{xMin:320,xMax:330,yMin:150,yMax:205},finish:{xMin:500,xMax:510,yMin:80,yMax:300},color:{r:"255",g:"255",b:"0",opasity:1}},RightCONUSred:{conus:1,start:{xMin:320,xMax:330,yMin:150,yMax:205},finish:{xMin:500,xMax:510,yMin:80,yMax:300},color:{r:"255",g:"0",b:"0",opasity:1}},RightCONUSgreen:{conus:1,start:{xMin:320,xMax:330,yMin:150,yMax:205},finish:{xMin:500,xMax:510,yMin:80,yMax:300},color:{r:"0",g:"255",b:"0",opasity:1}},RightCONUSSuperSpr:{conus:1,start:{xMin:320,xMax:330,yMin:150,yMax:205},finish:{xMin:500,xMax:510,yMin:80,yMax:300},color:{r:"0",g:"255",b:"255",opasity:1}},LeftCONUSSuperSpr:{conus:1,start:{xMin:-20,xMax:-10,yMin:80,yMax:300},finish:{xMin:160,xMax:280,yMin:150,yMax:205},color:{r:"0",g:"255",b:"255",opasity:1}},TopCONUSSuperSpr:{conus:1,start:{xMin:300,xMax:400,yMin:200,yMax:300},finish:{xMin:600,xMax:600,yMin:0,yMax:600},color:{r:"0",g:"255",b:"255",opasity:.3}}},T=[],H=0;window.onload=function(){B(function(){var t=v();F(t),P(t),x(P),we(),Z(),se(),V(),E(),R(),M(N),I.render(D,k),e()})};var L={earthRed:0,earthGreen:.04,earthBlue:.08,glowRed:0,glowGreen:.19,glowBlue:.22,glowLight:0,glowBorder:2.9,wireColor:"#ffae23",wireDiodRed:.9,wireDiodGreen:.9,wireDiodBlue:.9,earthLeftMax:-2,earthRightMax:.45,earthAxell:85e-5,earthMaxSpd:.017,earthSpdFree:.015},C="DARK",N=function(){return C="FLASH"},_=function(){"FLASH"==C&&te()&&Me()&&(C="LIGHT"),J(C),he(C),Ee(C)},U=void 0,O=void 0,A={textures:{waterNormals:null,continents:null},geoms:{corpus:null,diod:null}},B=function(e){U=new THREE.TextureLoader,O=new THREE.OBJLoader,new Promise(function(e){A.textures.continents=U.load("assets/contour.jpg",function(){e()})}).then(function(){return new Promise(function(e){O.load("assets/connector.obj",function(t){t.traverse(function(t){t instanceof THREE.Mesh==1&&("diod"==t.name&&(A.geoms.diod=t.geometry),"iron"==t.name&&(A.geoms.corpus=t.geometry),A.geoms.diod&&A.geoms.corpus&&e())})})})}).then(function(){U=null,O=null,e()})},D=void 0,G=void 0,j=void 0,I=void 0,k=void 0,F=function(e){j=new THREE.WebGLRenderer({canvas:document.getElementById("webgl")}),I=new THREE.WebGLRenderer({canvas:document.getElementById("webgl_bottom")}),G=new THREE.PerspectiveCamera(20,e/(.7*e),3.5,15e3),G.position.set(-800,-200,8200),k=new THREE.PerspectiveCamera(20,e/(.3*e),3.5,15e3),k.position.set(0,-2e3,-4e3),k.rotation.x=1.1;var t=new THREE.PointLight(252791645,.2);t.position.set(1e3,3e3,600);var i=new THREE.AmbientLight(9046131,.2);D=new THREE.Scene,D.add(t,i)},P=function(e){j.setSize(e,.7*e),G.aspect=e/(.7*e),G.updateProjectionMatrix(),I.setSize(e,.4*e),k.aspect=e/(.4*e),k.updateProjectionMatrix()},V=function e(){_(),j.render(D,G),"LIGHT"==C&&I.render(D,k),requestAnimationFrame(e)},z=void 0,Y=void 0,W=void 0,Z=function(){W=q(),Y=K(),z=new THREE.Group,z.rotation.z=-.3,z.rotation.x=.5,Y.rotation.y=.7,D.add(z.add(Y),W)},K=function(){var e=new THREE.Mesh(new THREE.SphereGeometry(608,40,40),new THREE.ShaderMaterial(f));return e.material.transparent=!0,e.material.side=THREE.DoubleSide,e.material.depthWrite=!1,e.material.needsUpdate=!0,e.material.uniforms.tDiffuse.value=A.textures.continents,e},q=function(){var e=new THREE.Mesh(new THREE.SphereGeometry(780,40,40),new THREE.ShaderMaterial(g));return e.material.transparent=!0,e.material.blending=THREE.AdditiveBlending,e.material.side=THREE.DoubleSide,e.material.depthWrite=!1,e.material.needsUpdate=!0,e},Q=.002,X="left",J=function(e){z&&("DARK"==e&&$(),"FLASH"==e&&ee(),Y.rotation.y+=Q)},$=function(){Y.rotation.y>L.earthLeftMax&&"left"==X&&(X="right"),Y.rotation.y<L.earthRightMax&&"right"==X&&(X="left"),"left"==X&&Math.abs(Q+L.earthAxell)<L.earthMaxSpd&&(Q+=L.earthAxell),"right"==X&&Math.abs(Q-L.earthAxell)<L.earthMaxSpd&&(Q-=L.earthAxell)},ee=function(){Q<L.earthSpdFree?Q+=3e-4:Q=L.earthSpdFree,Y.material.uniforms.light.value<1.35&&(Y.material.uniforms.light.value+=.012),W.material.uniforms.light.value<.1&&(W.material.uniforms.light.value+=.0034)},te=function(){return Q==L.earthSpdFree},ie=[],ne=[{dirY:6.08,dirZ:.8},{dirY:.2,dirZ:1.8},{dirY:3.24,dirZ:.8},{dirY:1.5,dirZ:.8},{dirY:1.9,dirZ:1.8},{dirY:3.7,dirZ:2}],re=void 0,oe=void 0,ae=void 0,se=function(){oe=le(),ae=ue(),re=new THREE.Group,ne.forEach(function(e){var t=ce(),i=de();t.plug.add(i);var n=new THREE.Group;n.add(t.plug),n.position.set(Math.sin(e.dirZ)*Math.sin(e.dirY)*795,795*Math.cos(e.dirZ),Math.sin(e.dirZ)*Math.cos(e.dirY)*795),n.lookAt(0,0,0),ie.push({connector:n,plug:t.plug,corpus:t.corpus,diod:t.diod,wire:i}),re.add(n)}),Y.add(re)},le=function(){return new THREE.MeshPhongMaterial({color:789017,emissive:0,specular:16777215,shininess:100})},ue=function(){return new THREE.ShaderMaterial(p)},ce=function(){var e=new THREE.Mesh(A.geoms.corpus,oe),t=new THREE.Mesh(A.geoms.diod,ae),i=new THREE.Group;return i.add(t,e),{plug:i,corpus:e,diod:t}},de=function(){var e=new THREE.QuadraticBezierCurve3(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,-1e3),new THREE.Vector3(0,0,-3500)),t=new THREE.TubeBufferGeometry(e,10,25,8,!1);return new THREE.Mesh(t,oe)},fe=function(){if(0!=ie.length){for(var e=0;e<ie.length;e++){ie[e].plug.remove(ie[e].corpus),ie[e].plug.remove(ie[e].diod),re.remove(ie[e].plug),re.remove(ie[e].wire);ie[e];ie.splice(e,1),e--,null}D.remove(re),ie=[]}},ge=.005,pe="DARK",he=function(e){0!=ie.length&&("DARK"==e&&ve(),"FLASH"==e&&("DARK"==pe&&(xe(),pe="FLASH"),me()))},ve=function(){ie.forEach(function(e){e.plug&&e.wire&&(e.wire.geometry.parameters.path.v2.x=5e3*Math.sin(Y.rotation.y-.4),e.wire.geometry.dispose(),e.wire.geometry=new THREE.TubeBufferGeometry(e.wire.geometry.parameters.path,30,25,8,!1),e.wire.geometry.needsUpdate=!0)})},xe=function(){Y.getWorldQuaternion(re.quaternion),Y.remove(re),D.add(re)},me=function(){ae.uniforms.light.value-=.01,ge+=.6,ie.forEach(function(e){e.plug.position.z-=ge})},Me=function(){return 0==ie.length||(!ie[0].plug||ie[0].plug.position.z<-5e3&&(fe(),!0))},ye=[],we=function(){for(var e=new THREE.MeshPhongMaterial({color:2024890,emissive:0,specular:12632256,shininess:100}),t=new THREE.CubeGeometry(600,600,600),i=0;i<20;i++)for(var n=0;n<20;n++){var r=new THREE.Mesh(t,e);D.add(r),r.position.set(600*n-6e3,600*i-3e3,-6e3),r.rotation.x=n/5+i/5,ye.push(r)}},Ee=function(e){ye.forEach(function(e){e.rotation.x+=.01})}}();
